<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DATA BASE BY ZEN 7777</title>
    <!-- Memuat Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f7f8fc; }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                radial-gradient(circle at 15% 20%, rgba(167, 139, 250, 0.2) 0%, transparent 40%),
                radial-gradient(circle at 85% 75%, rgba(125, 211, 252, 0.2) 0%, transparent 40%);
            z-index: -1;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; }
        ::-webkit-scrollbar-thumb { background: #a7abb4; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        @keyframes pulse-glow {
            0%, 100% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.05); opacity: 1; }
        }
        .profile-avatar::after {
            content: ''; position: absolute; top: -2px; left: -2px;
            right: -2px; bottom: -2px; border-radius: 9999px; z-index: 0;
            animation: pulse-glow 2.5s infinite ease-in-out;
            box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.7); transition: box-shadow 0.3s ease-in-out;
        }
        .animate-pulse-green::after { box-shadow: 0 0 12px 2px rgba(34, 197, 94, 0.6); }
        .animate-pulse-red::after { box-shadow: 0 0 12px 2px rgba(239, 68, 68, 0.6); }
        .animate-pulse-yellow::after { box-shadow: 0 0 12px 2px rgba(245, 158, 11, 0.6); }

        .card-selected {
            transform: translateY(-2px);
            box-shadow: 0 0 0 2px #6366f1; /* Cincin indigo */
        }
    </style>
</head>
<body class="antialiased pb-24">

    <div class="container mx-auto px-4 py-8 md:py-12">
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900 tracking-wider">DATA BASE BY ZEN 7777</h1>
            <p id="total-email-count" class="mt-4 text-md font-semibold text-slate-700 bg-slate-200 inline-block px-3 py-1 rounded-full"></p>
        </header>

        <main>
            <div class="mb-8 max-w-xl mx-auto">
                <div class="flex gap-2">
                    <div class="relative flex-grow">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                        </div>
                        <input type="text" id="search-input" placeholder="Cari berdasarkan email..." class="w-full pl-10 pr-4 py-2.5 bg-white border border-slate-300 text-slate-900 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-violet-500 outline-none transition duration-150 ease-in-out">
                    </div>
                    <button id="open-modal-btn" title="Identifikasi Email Massal" class="flex-shrink-0 px-4 py-2 bg-white border border-slate-300 rounded-lg hover:bg-slate-100 transition duration-150">
                        <svg class="h-5 w-5 text-slate-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
                        </svg>
                    </button>
                    <button id="refresh-data-btn" title="Segarkan Data dari Spreadsheet" class="flex-shrink-0 w-12 h-11 bg-white border border-slate-300 rounded-lg hover:bg-slate-100 transition duration-150 flex items-center justify-center">
                        <svg id="refresh-icon" class="h-5 w-5 text-slate-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                        </svg>
                        <svg id="refresh-spinner" class="animate-spin h-5 w-5 text-slate-600 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    </button>
                </div>
            </div>

            <div id="status-container" class="text-center py-10">
                <div id="loading" class="flex items-center justify-center space-x-3">
                    <svg class="animate-spin h-8 w-8 text-violet-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    <span class="text-xl text-slate-600 font-medium">Memuat data...</span>
                </div>
                <div id="error" class="hidden text-red-600 bg-red-100 border border-red-300 rounded-lg p-4">
                    <p class="font-semibold">Gagal memuat data!</p>
                    <p class="text-sm mt-1">Pastikan link Google Sheets valid dan dapat diakses publik.</p>
                </div>
            </div>

            <div id="kanban-board" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-5 items-start">
                <div class="bg-green-100 border-t-4 border-green-500 rounded-lg p-3 flex flex-col shadow-sm">
                    <h3 class="font-bold text-green-800 px-2 pb-2 flex justify-between items-center">New Acc <span id="new-acc-count" class="text-sm bg-green-200 text-green-800 font-semibold px-2 py-0.5 rounded-full">0</span></h3>
                    <div id="new-acc-list" class="space-y-3 p-1"></div>
                </div>
                <div class="bg-amber-100 border-t-4 border-amber-500 rounded-lg p-3 flex flex-col shadow-sm">
                    <h3 class="font-bold text-amber-800 px-2 pb-2 flex justify-between items-center">Unrestric<span id="unrestric-count" class="text-sm bg-amber-200 text-amber-800 font-semibold px-2 py-0.5 rounded-full">0</span></h3>
                    <div id="unrestric-list" class="space-y-3 p-1"></div>
                </div>
                <div class="bg-blue-100 border-t-4 border-blue-500 rounded-lg p-3 flex flex-col shadow-sm">
                     <h3 class="font-bold text-blue-800 px-2 pb-2 flex justify-between items-center">Old Acc<span id="old-acc-count" class="text-sm bg-blue-200 text-blue-800 font-semibold px-2 py-0.5 rounded-full">0</span></h3>
                    <div id="old-acc-list" class="space-y-3 p-1"></div>
                </div>
                <div class="bg-rose-100 border-t-4 border-rose-500 rounded-lg p-3 flex flex-col shadow-sm">
                     <h3 class="font-bold text-rose-800 px-2 pb-2 flex justify-between items-center">Restric<span id="restric-count" class="text-sm bg-rose-200 text-rose-800 font-semibold px-2 py-0.5 rounded-full">0</span></h3>
                    <div id="restric-list" class="space-y-3 p-1"></div>
                </div>
            </div>

            <div id="no-results" class="hidden text-center py-10">
                <h3 class="text-xl font-semibold text-slate-700">Tidak Ditemukan</h3>
                <p class="text-slate-500 mt-2">Data yang Anda cari tidak ada dalam daftar.</p>
            </div>
        </main>
    </div>

    <div id="fab-container" class="hidden fixed bottom-5 left-1/2 -translate-x-1/2 z-40">
        <button id="copy-selected-btn" class="flex items-center gap-3 bg-indigo-600 text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-indigo-700 transition-transform duration-200 hover:scale-105">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>
            <span id="copy-count">Salin 0 Pilihan</span>
        </button>
    </div>

     <div id="toast" class="hidden fixed top-5 left-1/2 -translate-x-1/2 bg-slate-900 text-white text-sm font-semibold py-2 px-4 rounded-full shadow-lg transition-all duration-300 opacity-0 -translate-y-10">
        Teks berhasil disalin!
    </div>

    <div id="bulk-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div id="modal-overlay" class="absolute inset-0 bg-black bg-opacity-60"></div>
        <div class="relative bg-white rounded-lg shadow-xl w-full max-w-lg mx-auto transform transition-transform duration-300 scale-95">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 class="text-lg font-semibold">Identifikasi Email Massal</h3>
                <button id="close-modal-btn" class="text-slate-400 hover:text-slate-600 text-2xl leading-none">&times;</button>
            </div>
            <div class="p-4">
                <textarea id="bulk-input" rows="5" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-violet-500" placeholder="Tempel daftar email di sini..."></textarea>
                <div class="mt-4 flex gap-3">
                    <button id="bulk-search-btn" class="w-full bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-violet-700">Identifikasi</button>
                    <button id="reset-btn" class="w-full bg-slate-200 text-slate-800 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300">Reset</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SPREADSHEET_ID = '19hSqumZNS1UEylAEnmrlteTuJjVcRgiNhgNJYDxom1M';
        const SHEET_NAME = 'Sheet1';
        const API_URL_BASE = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;

        let allData = [];
        let selectedEmails = new Set();

        const listContainers = {
            newAcc: document.getElementById('new-acc-list'),
            unrestric: document.getElementById('unrestric-list'),
            oldAcc: document.getElementById('old-acc-list'),
            restric: document.getElementById('restric-list')
        };
        const countSpans = {
            newAcc: document.getElementById('new-acc-count'),
            unrestric: document.getElementById('unrestric-count'),
            oldAcc: document.getElementById('old-acc-count'),
            restric: document.getElementById('restric-count')
        };
        const kanbanBoard = document.getElementById('kanban-board');
        
        const loadingIndicator = document.getElementById('loading');
        const errorContainer = document.getElementById('error');
        const statusContainer = document.getElementById('status-container');
        const searchInput = document.getElementById('search-input');
        const noResultsMessage = document.getElementById('no-results');
        const totalEmailCount = document.getElementById('total-email-count');
        
        const bulkModal = document.getElementById('bulk-modal');
        const modalOverlay = document.getElementById('modal-overlay');
        const openModalBtn = document.getElementById('open-modal-btn');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const bulkInput = document.getElementById('bulk-input');
        const bulkSearchBtn = document.getElementById('bulk-search-btn');
        const resetBtn = document.getElementById('reset-btn');

        const fabContainer = document.getElementById('fab-container');
        const copySelectedBtn = document.getElementById('copy-selected-btn');
        const copyCountSpan = document.getElementById('copy-count');
        const toast = document.getElementById('toast');
        
        const refreshDataBtn = document.getElementById('refresh-data-btn');
        const refreshIcon = document.getElementById('refresh-icon');
        const refreshSpinner = document.getElementById('refresh-spinner');

        document.addEventListener('DOMContentLoaded', initialLoad);
        searchInput.addEventListener('input', handleSearch);
        
        openModalBtn.addEventListener('click', openBulkModal);
        closeModalBtn.addEventListener('click', closeBulkModal);
        modalOverlay.addEventListener('click', closeBulkModal);
        bulkSearchBtn.addEventListener('click', handleBulkSearch);
        resetBtn.addEventListener('click', handleReset);
        copySelectedBtn.addEventListener('click', handleCopySelected);
        refreshDataBtn.addEventListener('click', handleRefreshData);

        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !bulkModal.classList.contains('hidden')) {
                closeBulkModal();
            }
        });

        async function fetchAndParseData() {
            const API_URL = `${API_URL_BASE}&t=${new Date().getTime()}`;
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const csvText = await response.text();
            return parseCSV(csvText);
        }

        async function initialLoad() {
            try {
                allData = await fetchAndParseData();
                if (allData.length > 0) {
                    totalEmailCount.textContent = `Total Akun Ditemukan: ${allData.length}`;
                    displayData(allData);
                    statusContainer.classList.add('hidden');
                } else {
                    totalEmailCount.textContent = 'Tidak ada data ditemukan.';
                    throw new Error("Tidak ada data valid yang ditemukan.");
                }
            } catch (err) {
                console.error("Gagal mengambil data:", err);
                showError();
            }
        }
        
        async function handleRefreshData() {
            refreshIcon.classList.add('hidden');
            refreshSpinner.classList.remove('hidden');
            refreshDataBtn.disabled = true;

            try {
                const newData = await fetchAndParseData();
                const newCount = newData.length;
                const oldCount = allData.length;
                allData = newData;

                searchInput.value = '';
                displayData(allData);
                toggleNoResults(false);
                totalEmailCount.textContent = `Total Akun Ditemukan: ${newCount}`;
                
                const addedCount = newCount - oldCount;
                if (addedCount > 0) {
                    showToast(`Data diperbarui. ${addedCount} akun baru ditemukan.`);
                } else if (newCount < oldCount) {
                    showToast(`Data diperbarui. Beberapa akun telah dihapus.`);
                } else {
                    showToast(`Data berhasil diperbarui. Tidak ada perubahan.`);
                }
            } catch (err) {
                console.error("Gagal menyegarkan data:", err);
                showToast("Gagal menyegarkan data. Coba lagi nanti.");
            } finally {
                refreshIcon.classList.remove('hidden');
                refreshSpinner.classList.add('hidden');
                refreshDataBtn.disabled = false;
            }
        }

        function updateCopyButtonUI() {
            const count = selectedEmails.size;
            if (count > 0) {
                copyCountSpan.textContent = `Salin ${count} Pilihan`;
                fabContainer.classList.remove('hidden');
            } else {
                fabContainer.classList.add('hidden');
            }
        }

        function handleCopySelected() {
            const selectedData = allData.filter(item => selectedEmails.has(item.email));
            const textToCopy = selectedData
                .map(item => `${item.email}, ${item['Status'] || ''}`)
                .join('\n');
            
            const textarea = document.createElement('textarea');
            textarea.value = textToCopy;
            textarea.style.position = 'fixed'; 
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                const successful = document.execCommand('copy');
                const msg = successful ? 'Email & Status berhasil disalin!' : 'Gagal menyalin.';
                showToast(msg);
            } catch (err) {
                console.error('Gagal menyalin:', err);
                showToast('Gagal menyalin ke clipboard.');
            }

            document.body.removeChild(textarea);
        }

        function showToast(message) {
            toast.textContent = message;
            toast.classList.remove('hidden', 'opacity-0', '-translate-y-10');
            setTimeout(() => {
                toast.classList.add('opacity-0', '-translate-y-10');
                setTimeout(() => toast.classList.add('hidden'), 300);
            }, 2500);
        }
        
        function handleSearch(event) {
            const searchTerm = event.target.value.toLowerCase().trim();
            const filteredData = allData.filter(item => (item.email || '').toLowerCase().trim().includes(searchTerm));
            displayData(filteredData);
            toggleNoResults(filteredData.length === 0 && searchTerm);
        }

        function handleBulkSearch() {
            const text = bulkInput.value.trim();
            if (!text) { handleReset(); return; }

            const emailsToFind = new Set(text.split(/[\s,;\n]+/).filter(Boolean).map(e => e.toLowerCase().trim()));
            const filteredData = allData.filter(item => emailsToFind.has((item.email || '').toLowerCase().trim()));
            
            displayData(filteredData);
            toggleNoResults(filteredData.length === 0);
            closeBulkModal();
        }

        function openBulkModal() {
            bulkModal.classList.remove('hidden');
            bulkModal.querySelector('.transform').classList.add('scale-100');
        }

        function closeBulkModal() {
            bulkModal.querySelector('.transform').classList.remove('scale-100');
            setTimeout(() => { bulkModal.classList.add('hidden'); }, 200);
        }
        
        function handleReset() {
            searchInput.value = '';
            bulkInput.value = '';
            selectedEmails.clear();
            updateCopyButtonUI();
            displayData(allData);
            toggleNoResults(false);
            if (!bulkModal.classList.contains('hidden')) {
                closeBulkModal();
            }
        }
        
        function toggleNoResults(show) {
             noResultsMessage.classList.toggle('hidden', !show);
             kanbanBoard.classList.toggle('hidden', show);
        }

        function parseCSV(csvText) {
            const rows = csvText.trim().split('\n');
            if (rows.length < 2) return [];
            const headers = rows[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const emailHeader = headers.find(h => h.toLowerCase() === 'email');
            
            return rows.slice(1)
                .map(row => {
                    const values = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
                    if (values.length < headers.length) return null;
                    const obj = {};
                    headers.forEach((header, index) => {
                        obj[header] = (values[index] || '').trim().replace(/^"|"$/g, '');
                    });
                    if (emailHeader) obj.email = obj[emailHeader];
                    return obj;
                })
                .filter(item => item && item.email && item.email.includes('@'));
        }

        function displayData(data) {
            Object.values(listContainers).forEach(list => list.innerHTML = '');
            const buckets = { newAcc: [], unrestric: [], oldAcc: [], restric: [], others: [] };

            data.forEach(item => {
                const status = (item['Status'] || '').toLowerCase().trim();
                switch (status) {
                    case 'new acc': buckets.newAcc.push(item); break;
                    case 'unrestric': buckets.unrestric.push(item); break;
                    case 'old acc': buckets.oldAcc.push(item); break;
                    case 'restric': buckets.restric.push(item); break;
                    default: buckets.others.push(item); break;
                }
            });
            
            buckets.newAcc.sort((a,b) => a.email.localeCompare(b.email)).forEach(item => listContainers.newAcc.appendChild(createCard(item)));
            countSpans.newAcc.textContent = buckets.newAcc.length;

            buckets.unrestric.sort((a,b) => a.email.localeCompare(b.email)).forEach(item => listContainers.unrestric.appendChild(createCard(item)));
            countSpans.unrestric.textContent = buckets.unrestric.length;
            
            buckets.oldAcc.sort((a,b) => a.email.localeCompare(b.email)).forEach(item => listContainers.oldAcc.appendChild(createCard(item)));
            countSpans.oldAcc.textContent = buckets.oldAcc.length;

            buckets.restric.sort((a,b) => a.email.localeCompare(b.email)).forEach(item => listContainers.restric.appendChild(createCard(item)));
            countSpans.restric.textContent = buckets.restric.length;
        }

        function createCard(item) {
            const card = document.createElement('div');
            card.className = 'bg-white/80 backdrop-blur-sm rounded-lg shadow-sm border border-slate-200/80 p-3 transform transition-all hover:shadow-lg hover:-translate-y-0.5 flex flex-col cursor-pointer';
            
            const gmailLogoSVG = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 7.78V16.5C22 17.88 20.88 19 19.5 19H4.5C3.12 19 2 17.88 2 16.5V7.78L10.6 12.89C11.37 13.35 12.63 13.35 13.4 12.89L22 7.78Z" fill="#4285F4"/><path d="M13.4 11.11L21.98 6.02C21.77 5.41 21.21 5 20.5 5H3.5C2.79 5 2.23 5.41 2.02 6.02L10.6 11.11C11.37 11.57 12.63 11.57 13.4 11.11Z" fill="#DB4437"/><path d="M2 16.5V7.78L7.5 11.08L2 16.5Z" fill="#F4B400"/><path d="M22 16.5V7.78L16.5 11.08L22 16.5Z" fill="#0F9D58"/></svg>`;
            const email = item.email || 'Email tidak tersedia';
            const status = (item['Status'] || '').toLowerCase().trim();
            let animationClass = '';

            switch (status) {
                case 'new acc': animationClass = 'animate-pulse-green'; break;
                case 'restric': animationClass = 'animate-pulse-red'; break;
                case 'unrestric': animationClass = 'animate-pulse-yellow'; break;
                case 'old acc': animationClass = 'animate-pulse-green'; break;
            }
            
            const checkboxHTML = `<input type="checkbox" class="form-checkbox h-5 w-5 text-indigo-600 border-slate-300 rounded focus:ring-indigo-500 cursor-pointer" ${selectedEmails.has(email) ? 'checked' : ''}>`;
            
            if (selectedEmails.has(email)) {
                card.classList.add('card-selected');
            }

            const cardHeader = `<div class="flex items-center gap-3"><div class="flex-shrink-0 w-10 h-10 relative profile-avatar ${animationClass}"><div class="w-full h-full bg-white rounded-full flex items-center justify-center relative z-10 border-2 border-slate-200/50">${gmailLogoSVG}</div></div><div class="overflow-hidden flex-1 min-w-0"><h3 class="text-sm font-semibold text-slate-800 leading-tight truncate" title="${email}">${email}</h3></div><div class="ml-2">${checkboxHTML}</div></div>`;
            
            let cardContent = '', detailsHtml = '';
            const fieldsToSkip = ['email', 'status', 'no whatsapp', 'payment', 'note'];
            const note = item['Note'] || '';
            const payment = (item['Payment'] || '').trim();
            let hasDetails = false;

            for (const key in item) {
                if (Object.hasOwnProperty.call(item, key) && item[key]) {
                    if (fieldsToSkip.includes(key.toLowerCase())) continue;
                    hasDetails = true;
                    detailsHtml += `<div class="text-xs mt-1"><p class="font-medium text-slate-500">${key}</p><p class="text-slate-700 font-medium truncate">${item[key]}</p></div>`;
                }
            }
            let footerHtml = '';
            if (note || payment) {
                let paymentBadge = '';
                if (payment) {
                    let badgeColor = 'bg-slate-200 text-slate-800';
                    if (payment === '$10') badgeColor = 'bg-green-100 text-green-800';
                    else if (payment === '$15') badgeColor = 'bg-amber-100 text-amber-800';
                    else if (payment === '$1') badgeColor = 'bg-red-100 text-red-800';
                    paymentBadge = `<div class="text-xs font-bold py-1 px-2.5 rounded-full ${badgeColor}">${payment}</div>`;
                }
                footerHtml = `<div class="mt-auto pt-2 flex justify-between items-end gap-3"><div class="text-xs overflow-hidden min-w-0">${note ? `<p class="font-medium text-slate-500">Note</p><p class="text-slate-600 font-medium truncate" title="${note}">${note}</p>` : ''}</div><div class="flex-shrink-0">${paymentBadge}</div></div>`;
            }
            if (hasDetails || footerHtml) {
                 cardContent = `<div class="mt-2 pt-2 border-t border-slate-200/60 flex-grow flex flex-col"><div class="space-y-1.5">${detailsHtml}</div>${footerHtml}</div>`;
            }
            card.innerHTML = cardHeader + cardContent;
            
            const checkbox = card.querySelector('input[type="checkbox"]');
            
            card.addEventListener('click', (e) => {
                if (e.target !== checkbox) {
                    checkbox.checked = !checkbox.checked;
                    checkbox.dispatchEvent(new Event('change'));
                }
            });
            
            checkbox.addEventListener('change', (e) => {
                if (e.target.checked) {
                    selectedEmails.add(email);
                    card.classList.add('card-selected');
                } else {
                    selectedEmails.delete(email);
                    card.classList.remove('card-selected');
                }
                updateCopyButtonUI();
            });
            
            return card;
        }

        function showError() {
            loadingIndicator.classList.add('hidden');
            errorContainer.classList.remove('hidden');
            statusContainer.classList.remove('hidden');
        }
    </script>
</body>
</html>

